<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vote for Your Favorite!</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-b from-gray-100 to-gray-50 min-h-screen flex items-center justify-center">
  <div class="w-full max-w-xl p-6 bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg">
    <h1 class="text-center text-3xl font-extrabold text-gray-800 mb-4">Vote for Your Favorite!</h1>
    <p class="text-center text-sm text-gray-600 mb-6">Click a button below to cast your vote.</p>

    <form id="voteForm" class="flex flex-col sm:flex-row items-center justify-center gap-4" >
      <button type="submit" id="catsBtn" class="w-44 inline-flex items-center justify-center gap-2 px-4 py-3 bg-rose-500 hover:bg-rose-600 text-white font-semibold rounded-lg shadow-md focus:outline-none transition">üê± Cats</button>
      <button type="submit" id="dogsBtn" class="w-44 inline-flex items-center justify-center gap-2 px-4 py-3 bg-sky-600 hover:bg-sky-700 text-white font-semibold rounded-lg shadow-md focus:outline-none transition">üê∂ Dogs</button>
    </form>

    <div id="result" class="mt-6 text-center" aria-live="polite"></div>
  </div>

  <script>
    const form = document.getElementById('voteForm');
    const result = document.getElementById('result');
    const catsBtn = document.getElementById('catsBtn');
    const dogsBtn = document.getElementById('dogsBtn');

    function setButtonsDisabled(disabled) {
      [catsBtn, dogsBtn].forEach(b => {
        b.disabled = disabled;
        if (disabled) {
          b.classList.add('opacity-60', 'cursor-not-allowed');
        } else {
          b.classList.remove('opacity-60', 'cursor-not-allowed');
        }
      });
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      result.innerHTML = '';
      setButtonsDisabled(true);

      // gather form data
      const formData = new FormData();
      const option = e.submitter && e.submitter.id === 'catsBtn' ? "0" : "1";
      formData.append('option', option);

      // show loading
      result.innerHTML = `<div class="inline-flex items-center gap-2 text-gray-700"><svg class="w-5 h-5 animate-spin text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg> Sending vote for <strong class="text-gray-800">${option}</strong>...</div>`;

      try {
        const resp = await fetch('/vote', {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json',
            'X-Requested-With': 'XMLHttpRequest'
          }
        });

        if (resp.ok) {
          const data = await resp.json();
          result.innerHTML = `<div class="inline-block px-4 py-3 rounded-lg bg-green-50 text-green-800 border border-green-100">${data.message}</div>`;

          // Keep buttons disabled after successful vote and mark chosen button
          setButtonsDisabled(true);
          const chosenBtn = option === 'cats' ? catsBtn : dogsBtn;
          // append a checkmark indicator if not already present
          if (!chosenBtn.querySelector('.voted-check')) {
            const span = document.createElement('span');
            span.className = 'voted-check ml-2 text-green-100 bg-green-600 rounded-full px-2 py-0.5 text-sm font-semibold';
            span.textContent = '‚úì';
            chosenBtn.appendChild(span);
          }
        } else {
          let text = 'An error occurred';
          try { const err = await resp.json(); text = err.message || text; } catch(e) { text = await resp.text(); }
          result.innerHTML = `<div class="inline-block px-4 py-3 rounded-lg bg-red-50 text-red-800 border border-red-100">${text}</div>`;
          // re-enable buttons on error so user can try again
          setButtonsDisabled(false);
        }
      } catch (err) {
        result.innerHTML = `<div class="inline-block px-4 py-3 rounded-lg bg-red-50 text-red-800 border border-red-100">Network error: ${err.message}</div>`;
        setButtonsDisabled(false);
      }
    });
  </script>
</body>
</html>
